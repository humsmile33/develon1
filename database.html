<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Space - ë°ì´í„°ë² ì´ìŠ¤</title>
    <!-- Supabase í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* --- CSS ë³€ìˆ˜ ë° ì´ˆê¸°í™” (ë””ìì¸ ì‹œìŠ¤í…œ) --- */
        :root {
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --bg-body: #f3f4f6;
            --bg-card: #ffffff;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
        }

        a {
            text-decoration: none;
            color: inherit;
            transition: color 0.2s;
        }

        ul {
            list-style: none;
        }

        /* --- ë ˆì´ì•„ì›ƒ ì»¨í…Œì´ë„ˆ --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* --- í—¤ë” (Header) --- */
        header {
            background-color: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            letter-spacing: -0.5px;
        }

        nav ul {
            display: flex;
            gap: 30px;
        }

        nav a {
            font-weight: 500;
            color: var(--text-main);
        }

        nav a:hover, nav a.active {
            color: var(--primary-color);
        }

        /* --- ë°ì´í„°ë² ì´ìŠ¤ ì„¹ì…˜ --- */
        .database-section {
            padding: 40px 0 60px;
        }

        .section-header {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .section-description {
            color: var(--text-sub);
            font-size: 1rem;
        }

        /* ë°ì´í„°ë² ì´ìŠ¤ ì„¹ì…˜ ìƒë‹¨ */
        .section-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        /* ë°ì´í„°ë² ì´ìŠ¤ ì¹´ë“œ ê·¸ë¦¬ë“œ */
        .database-grid {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 20px;
            margin-bottom: 40px;
        }

        .database-card {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            padding: 30px;
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
            cursor: pointer;
            min-width: 320px;
            max-width: 350px;
            flex-shrink: 0;
            border: 2px solid transparent;
            position: relative;
        }

        .database-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px -3px rgba(0, 0, 0, 0.15);
        }

        .database-card.selected {
            border-color: var(--primary-color);
            background-color: #f0f7ff;
        }

        .database-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .database-name {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .database-description {
            color: var(--text-sub);
            font-size: 0.9rem;
            margin-bottom: 15px;
            min-height: 42px;
        }

        .database-stats {
            display: flex;
            gap: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-sub);
        }

        /* ì¹´ë“œ ì‚­ì œ ë²„íŠ¼ */
        .delete-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: #fee2e2;
            color: #dc2626;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 1rem;
            opacity: 0;
            transition: opacity 0.2s, background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .database-card:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background-color: #fecaca;
        }

        /* + ë²„íŠ¼ */
        .add-database-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius);
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-database-btn:hover {
            background-color: var(--primary-hover);
            transform: scale(1.1);
        }

        /* ìƒì„¸ ì„¹ì…˜ */
        .detail-section {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            padding: 30px;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .detail-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-title h2 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .last-update {
            font-size: 0.85rem;
            color: var(--text-sub);
        }

        /* í•„í„° ì»¨íŠ¸ë¡¤ */
        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 0.9rem;
            background-color: white;
            cursor: pointer;
        }

        .refresh-btn {
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .refresh-btn:hover {
            background-color: var(--primary-hover);
        }

        /* ê¸ˆì‹œì„¸ í…Œì´ë¸” */
        .table-wrapper {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background-color: #f9fafb;
        }

        .data-table th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-sub);
            font-size: 0.9rem;
            border-bottom: 2px solid var(--border-color);
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.95rem;
        }

        .data-table tbody tr:hover {
            background-color: #f9fafb;
        }

        /* ë°ì´í„° ë¡œë”© ìƒíƒœ */
        .loading-state {
            text-align: center;
            padding: 40px;
            color: var(--text-sub);
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid #e5e7eb;
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-sub);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        /* --- ëª¨ë‹¬ (Modal) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background-color: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            padding: 30px;
            max-width: 500px;
            width: 90%;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 0.95rem;
            font-family: var(--font-family);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .icon-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .icon-option {
            width: 50px;
            height: 50px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: border-color 0.2s, background-color 0.2s;
        }

        .icon-option:hover {
            border-color: var(--primary-color);
            background-color: #f0f7ff;
        }

        .icon-option.selected {
            border-color: var(--primary-color);
            background-color: #dbeafe;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-secondary {
            background-color: var(--bg-body);
            color: var(--text-main);
        }

        .btn-secondary:hover {
            background-color: #e5e7eb;
        }

        /* --- í‘¸í„° (Footer) --- */
        footer {
            background-color: var(--text-main);
            color: #d1d5db;
            padding: 40px 0;
            margin-top: 40px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-info p {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .footer-links a {
            font-size: 0.9rem;
            margin-left: 20px;
        }

        .footer-links a:hover {
            color: white;
        }

        /* --- ë°˜ì‘í˜• ì²˜ë¦¬ --- */
        @media (max-width: 768px) {
            .header-inner {
                flex-direction: column;
                height: auto;
                padding: 15px 0;
                gap: 15px;
            }

            nav ul {
                gap: 15px;
                font-size: 0.9rem;
            }

            .section-top {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .section-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>

    <!-- í—¤ë” ì˜ì—­ -->
    <header>
        <div class="container header-inner">
            <a href="index.html" class="logo">Modern Space</a>
            <nav>
                <ul>
                    <li><a href="index.html">í™ˆ</a></li>
                    <li><a href="#">ì†Œê°œ</a></li>
                    <li><a href="index.html">ê²Œì‹œíŒ</a></li>
                    <li><a href="database.html" class="active">ë°ì´í„°ë² ì´ìŠ¤</a></li>
                    <li><a href="#">ë¬¸ì˜</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <!-- ë°ì´í„°ë² ì´ìŠ¤ ì„¹ì…˜ -->
        <section class="container database-section">
            <div class="section-header">
                <h1 class="section-title">ë°ì´í„°ë² ì´ìŠ¤</h1>
                <p class="section-description">ë‹¤ì–‘í•œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ íƒìƒ‰í•˜ê³  ë¶„ì„í•˜ì„¸ìš”.</p>
            </div>

            <!-- ì„¹ì…˜ ìƒë‹¨ -->
            <div class="section-top">
                <h2 style="font-size: 1.25rem; font-weight: 600;">ë°ì´í„°ë² ì´ìŠ¤ ëª©ë¡</h2>
                <button class="add-database-btn" id="addDatabaseBtn" title="ë°ì´í„°ë² ì´ìŠ¤ ì¶”ê°€">+</button>
            </div>

            <!-- ë°ì´í„°ë² ì´ìŠ¤ ì¹´ë“œ ê·¸ë¦¬ë“œ -->
            <div class="database-grid" id="databaseGrid">
                <!-- ì¹´ë“œëŠ” JavaScriptë¡œ ë™ì  ë Œë”ë§ -->
            </div>

            <!-- ìƒì„¸ ì„¹ì…˜ -->
            <div class="detail-section" id="detailSection" style="display: none;">
                <div class="detail-header">
                    <div class="detail-title">
                        <span id="detailIcon" class="database-icon">ğŸ…</span>
                        <h2 id="detailTitle">ê¸ˆì‹œì„¸ í¬ë¡¤ë§ ë°ì´í„°</h2>
                    </div>
                    <span class="last-update" id="lastUpdateTime">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</span>
                </div>

                <!-- ê¸ˆì‹œì„¸ í•„í„° ë° í…Œì´ë¸” -->
                <div id="goldPriceContent">
                    <div class="filter-controls">
                        <div class="filter-group">
                            <span class="filter-label">ì •ë ¬:</span>
                            <select class="filter-select" id="sortSelect">
                                <option value="date_desc">ìµœì‹ ìˆœ</option>
                                <option value="date_asc">ì˜¤ë˜ëœìˆœ</option>
                                <option value="price_desc">ë†’ì€ ê°€ê²©ìˆœ</option>
                                <option value="price_asc">ë‚®ì€ ê°€ê²©ìˆœ</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <span class="filter-label">ê¸°ê°„:</span>
                            <select class="filter-select" id="periodSelect">
                                <option value="all">ì „ì²´</option>
                                <option value="7">ìµœê·¼ 7ì¼</option>
                                <option value="30">ìµœê·¼ 30ì¼</option>
                                <option value="90">ìµœê·¼ 90ì¼</option>
                            </select>
                        </div>
                        <button class="refresh-btn" id="refreshBtn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                    </div>

                    <div class="table-wrapper">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 20%;">ë‚ ì§œ</th>
                                    <th style="width: 20%;">ë‚´ê°€ì‚´ë•Œ ìˆœê¸ˆ 3.75g</th>
                                    <th style="width: 20%;">ë‚´ê°€íŒ”ë•Œ ìˆœê¸ˆ 3.75g</th>
                                    <th style="width: 20%;">ë‚´ê°€íŒ”ë•Œ 18K 3.75g</th>
                                    <th style="width: 20%;">ë‚´ê°€íŒ”ë•Œ 14K 3.75g</th>
                                </tr>
                            </thead>
                            <tbody id="goldPriceTableBody">
                                <tr>
                                    <td colspan="5" class="loading-state">
                                        <div class="loading-spinner"></div>
                                        <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ê¸°íƒ€ ë°ì´í„°ë² ì´ìŠ¤ ë‚´ìš© -->
                <div id="otherDatabaseContent" style="display: none;">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“Š</div>
                        <p>ì´ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì•„ì§ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- í‘¸í„° ì˜ì—­ -->
    <footer>
        <div class="container footer-content">
            <div class="footer-info">
                <p><strong>Modern Space</strong></p>
                <p>ì£¼ì†Œ: ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬ëŒ€ë¡œ 123 | ëŒ€í‘œ: í™ê¸¸ë™</p>
                <p>Â© 2024 Modern Space. All rights reserved.</p>
            </div>
            <div class="footer-links">
                <a href="#">ì´ìš©ì•½ê´€</a>
                <a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                <a href="#">ê³ ê°ì„¼í„°</a>
            </div>
        </div>
    </footer>

    <!-- ë°ì´í„°ë² ì´ìŠ¤ ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="addModal">
        <div class="modal">
            <h3 class="modal-title">ë°ì´í„°ë² ì´ìŠ¤ ì¶”ê°€</h3>
            <form id="addDatabaseForm">
                <div class="form-group">
                    <label class="form-label">ì œëª©</label>
                    <input type="text" class="form-input" id="databaseName" required placeholder="ì˜ˆ: í™˜ìœ¨ ë°ì´í„°">
                </div>
                <div class="form-group">
                    <label class="form-label">ì„¤ëª…</label>
                    <textarea class="form-textarea" id="databaseDescription" required placeholder="ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">ì•„ì´ì½˜</label>
                    <div class="icon-selector" id="iconSelector">
                        <div class="icon-option" data-icon="ğŸ“Š">ğŸ“Š</div>
                        <div class="icon-option" data-icon="ğŸ“ˆ">ğŸ“ˆ</div>
                        <div class="icon-option" data-icon="ğŸŒ¦ï¸">ğŸŒ¦ï¸</div>
                        <div class="icon-option" data-icon="ğŸ’°">ğŸ’°</div>
                        <div class="icon-option" data-icon="ğŸ…">ğŸ…</div>
                        <div class="icon-option" data-icon="ğŸ“‰">ğŸ“‰</div>
                        <div class="icon-option" data-icon="ğŸ’¡">ğŸ’¡</div>
                        <div class="icon-option" data-icon="ğŸ¯">ğŸ¯</div>
                    </div>
                    <input type="hidden" id="selectedIcon" value="ğŸ“Š">
                </div>
                <div class="form-group">
                    <label class="form-label">í…Œì´ë¸”ëª…</label>
                    <input type="text" class="form-input" id="tableName" required placeholder="ì˜ˆ: exchange_rates">
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" id="cancelBtn">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary">ì¶”ê°€</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supabase ì—°ë™ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ==============================
        // Supabase ì„¤ì •
        // ==============================
        const SUPABASE_URL = 'https://wfzgznipfvkcgqnfwvuk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indmemd6bmlwZnZrY2dxbmZ3dnVrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY2MjI4MzcsImV4cCI6MjA4MjE5ODgzN30.Vzy5mJLVBFnwYt1e0UXhdN3WZDK7nqsgNwcFuIs0mTE';
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ==============================
        // ì „ì—­ ë³€ìˆ˜
        // ==============================
        let currentDatabase = null;
        let databaseList = [];

        // ==============================
        // ë°ì´í„°ë² ì´ìŠ¤ ì¹´ë“œ ë¡œë“œ
        // ==============================
        async function loadDatabaseCards() {
            try {
                const { data: databases, error } = await supabaseClient
                    .from('databases')
                    .select('*')
                    .eq('is_active', true)
                    .order('display_order', { ascending: true });

                if (error) {
                    console.error('ë°ì´í„°ë² ì´ìŠ¤ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                    return;
                }

                databaseList = databases || [];
                renderDatabaseCards(databaseList);

                // ì²« ë²ˆì§¸ ë°ì´í„°ë² ì´ìŠ¤ ìë™ ì„ íƒ
                if (databaseList.length > 0 && !currentDatabase) {
                    selectDatabase(databaseList[0]);
                }
            } catch (e) {
                console.error('ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜:', e);
            }
        }

        // ==============================
        // ë°ì´í„°ë² ì´ìŠ¤ ì¹´ë“œ ë Œë”ë§
        // ==============================
        function renderDatabaseCards(databases) {
            const grid = document.getElementById('databaseGrid');
            grid.innerHTML = databases.map(db => `
                <div class="database-card ${currentDatabase && currentDatabase.id === db.id ? 'selected' : ''}" 
                     data-id="${db.id}" onclick="selectDatabaseById(${db.id})">
                    <button class="delete-btn" onclick="event.stopPropagation(); deleteDatabase(${db.id})">ğŸ—‘ï¸</button>
                    <div class="database-icon">${db.icon}</div>
                    <h3 class="database-name">${db.name}</h3>
                    <p class="database-description">${db.description}</p>
                    <div class="database-stats">
                        <div class="stat-item">
                            <span class="stat-value" id="recordCount_${db.id}">-</span>
                            <span class="stat-label">ì´ ë ˆì½”ë“œ</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">-</span>
                            <span class="stat-label">ìƒíƒœ</span>
                        </div>
                    </div>
                </div>
            `).join('');

            // ê° ë°ì´í„°ë² ì´ìŠ¤ì˜ ë ˆì½”ë“œ ìˆ˜ ë¡œë“œ
            databases.forEach(db => loadRecordCount(db));
        }

        // ==============================
        // ë ˆì½”ë“œ ìˆ˜ ë¡œë“œ
        // ==============================
        async function loadRecordCount(db) {
            try {
                if (db.table_name === 'gold_prices') {
                    const { count } = await supabaseClient
                        .from('gold_prices')
                        .select('*', { count: 'exact', head: true });
                    document.getElementById(`recordCount_${db.id}`).textContent = (count || 0).toLocaleString();
                }
            } catch (e) {
                console.error('ë ˆì½”ë“œ ìˆ˜ ë¡œë“œ ì˜¤ë¥˜:', e);
            }
        }

        // ==============================
        // ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ
        // ==============================
        function selectDatabaseById(id) {
            const db = databaseList.find(d => d.id === id);
            if (db) {
                selectDatabase(db);
            }
        }

        function selectDatabase(db) {
            currentDatabase = db;

            // ì¹´ë“œ ì„ íƒ í‘œì‹œ
            document.querySelectorAll('.database-card').forEach(card => {
                card.classList.remove('selected');
                if (parseInt(card.dataset.id) === db.id) {
                    card.classList.add('selected');
                }
            });

            // ìƒì„¸ ì„¹ì…˜ í‘œì‹œ
            const detailSection = document.getElementById('detailSection');
            detailSection.style.display = 'block';

            // ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('detailIcon').textContent = db.icon;
            document.getElementById('detailTitle').textContent = db.name;

            // ë°ì´í„°ë² ì´ìŠ¤ ìœ í˜•ì— ë”°ë¼ ë‚´ìš© ë Œë”ë§
            const goldPriceContent = document.getElementById('goldPriceContent');
            const otherDatabaseContent = document.getElementById('otherDatabaseContent');

            if (db.table_name === 'gold_prices') {
                goldPriceContent.style.display = 'block';
                otherDatabaseContent.style.display = 'none';
                loadGoldPrices();
            } else {
                goldPriceContent.style.display = 'none';
                otherDatabaseContent.style.display = 'block';
            }

            // ìŠ¤í¬ë¡¤ ì´ë™
            detailSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // ==============================
        // ë°ì´í„°ë² ì´ìŠ¤ ì‚­ì œ
        // ==============================
        async function deleteDatabase(id) {
            if (!confirm('ì •ë§ë¡œ ì´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                const { error } = await supabaseClient
                    .from('databases')
                    .delete()
                    .eq('id', id);

                if (error) {
                    console.error('ë°ì´í„°ë² ì´ìŠ¤ ì‚­ì œ ì˜¤ë¥˜:', error);
                    alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
                    return;
                }

                // ì¹´ë“œ ë‹¤ì‹œ ë Œë”ë§
                await loadDatabaseCards();

                // ì„ íƒëœ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì‚­ì œë˜ì—ˆìœ¼ë©´ ìƒì„¸ ì„¹ì…˜ ìˆ¨ê¹€
                if (currentDatabase && currentDatabase.id === id) {
                    currentDatabase = null;
                    document.getElementById('detailSection').style.display = 'none';
                }

                alert('ë°ì´í„°ë² ì´ìŠ¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (e) {
                console.error('ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜:', e);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ==============================
        // ê¸ˆì‹œì„¸ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        // ==============================
        async function loadGoldPrices() {
            const tbody = document.getElementById('goldPriceTableBody');
            const sortSelect = document.getElementById('sortSelect');
            const periodSelect = document.getElementById('periodSelect');

            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </td>
                </tr>
            `;

            try {
                // ê¸ˆì‹œê³„ ë°ì´í„° ì¡°íšŒ (gold_prices í…Œì´ë¸”)
                let query = supabaseClient
                    .from('gold_prices')
                    .select('*')
                    .order('date', { ascending: false });

                // ê¸°ê°„ í•„í„°ë§
                const period = periodSelect.value;
                if (period !== 'all') {
                    const daysAgo = new Date();
                    daysAgo.setDate(daysAgo.getDate() - parseInt(period));
                    query = query.gte('date', daysAgo.toISOString().split('T')[0]);
                }

                const { data: goldPrices, error } = await query;

                if (error) {
                    console.error('ê¸ˆì‹œì„¸ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-state">
                                <div class="empty-icon">âš ï¸</div>
                                <p>ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}</p>
                                <p style="font-size: 0.9rem; margin-top: 10px;">í…Œì´ë¸”ì´ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                            </td>
                        </tr>
                    `;
                    return;
                }

                // ì •ë ¬ ì ìš©
                const sortBy = sortSelect.value;
                if (sortBy === 'date_asc') {
                    goldPrices.sort((a, b) => new Date(a.date) - new Date(b.date));
                } else if (sortBy === 'price_desc') {
                    goldPrices.sort((a, b) => b.sell_pure_375g - a.sell_pure_375g);
                } else if (sortBy === 'price_asc') {
                    goldPrices.sort((a, b) => a.sell_pure_375g - b.sell_pure_375g);
                }

                // í†µê³„ ì—…ë°ì´íŠ¸
                if (goldPrices && goldPrices.length > 0) {
                    const latestDate = goldPrices[0].date;
                    document.getElementById('lastUpdateTime').textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${formatDateTime(latestDate)}`;

                    // í…Œì´ë¸” ë Œë”ë§
                    tbody.innerHTML = goldPrices.map(price => `
                        <tr>
                            <td>${formatDate(price.date)}</td>
                            <td>${formatPrice(price.buy_pure_375g)}</td>
                            <td>${formatPrice(price.sell_pure_375g)}</td>
                            <td>${formatPrice(price.sell_18k_375g)}</td>
                            <td>${formatPrice(price.sell_14k_375g)}</td>
                        </tr>
                    `).join('');
                } else {
                    document.getElementById('lastUpdateTime').textContent = 'ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -';

                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-state">
                                <div class="empty-icon">ğŸ“Š</div>
                                <p>ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                                <p style="font-size: 0.9rem; margin-top: 10px;">í¬ë¡¤ë§ì´ ì‹¤í–‰ë˜ë©´ ë°ì´í„°ê°€ ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤.</p>
                            </td>
                        </tr>
                    `;
                }
            } catch (e) {
                console.error('ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜:', e);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <div class="empty-icon">âŒ</div>
                            <p>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                            <p style="font-size: 0.9rem; margin-top: 10px;">${e.message}</p>
                        </td>
                    </tr>
                `;
            }
        }

        // ==============================
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        // ==============================
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toISOString().split('T')[0];
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatPrice(price) {
            if (!price) return '-';
            return new Intl.NumberFormat('ko-KR', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(price);
        }

        // ==============================
        // ëª¨ë‹¬ ê´€ë¦¬
        // ==============================
        const modal = document.getElementById('addModal');
        const addDatabaseBtn = document.getElementById('addDatabaseBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const addDatabaseForm = document.getElementById('addDatabaseForm');
        const iconSelector = document.getElementById('iconSelector');
        const selectedIconInput = document.getElementById('selectedIcon');

        addDatabaseBtn.addEventListener('click', () => {
            modal.classList.add('active');
        });

        cancelBtn.addEventListener('click', () => {
            modal.classList.remove('active');
            addDatabaseForm.reset();
            resetIconSelection();
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
                addDatabaseForm.reset();
                resetIconSelection();
            }
        });

        // ì•„ì´ì½˜ ì„ íƒ
        iconSelector.addEventListener('click', (e) => {
            const iconOption = e.target.closest('.icon-option');
            if (iconOption) {
                resetIconSelection();
                iconOption.classList.add('selected');
                selectedIconInput.value = iconOption.dataset.icon;
            }
        });

        function resetIconSelection() {
            document.querySelectorAll('.icon-option').forEach(option => {
                option.classList.remove('selected');
            });
            selectedIconInput.value = 'ğŸ“Š';
        }

        // ë°ì´í„°ë² ì´ìŠ¤ ì¶”ê°€
        addDatabaseForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('databaseName').value;
            const description = document.getElementById('databaseDescription').value;
            const icon = selectedIconInput.value;
            const tableName = document.getElementById('tableName').value;

            try {
                // ìµœëŒ€ display_order ê°€ì ¸ì˜¤ê¸°
                const { data: existingDbs } = await supabaseClient
                    .from('databases')
                    .select('display_order')
                    .order('display_order', { ascending: false })
                    .limit(1);

                const nextOrder = existingDbs && existingDbs.length > 0 
                    ? existingDbs[0].display_order + 1 
                    : 1;

                // ë°ì´í„°ë² ì´ìŠ¤ ì¶”ê°€
                const { data, error } = await supabaseClient
                    .from('databases')
                    .insert({
                        name,
                        description,
                        icon,
                        table_name: tableName,
                        display_order: nextOrder
                    });

                if (error) {
                    console.error('ë°ì´í„°ë² ì´ìŠ¤ ì¶”ê°€ ì˜¤ë¥˜:', error);
                    alert('ì¶”ê°€ ì‹¤íŒ¨: ' + error.message);
                    return;
                }

                // ëª¨ë‹¬ ë‹«ê¸°
                modal.classList.remove('active');
                addDatabaseForm.reset();
                resetIconSelection();

                // ì¹´ë“œ ë‹¤ì‹œ ë Œë”ë§
                await loadDatabaseCards();

                alert('ë°ì´í„°ë² ì´ìŠ¤ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (e) {
                console.error('ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜:', e);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });

        // ==============================
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        // ==============================
        document.addEventListener('DOMContentLoaded', function() {
            // ë°ì´í„°ë² ì´ìŠ¤ ì¹´ë“œ ë¡œë“œ
            loadDatabaseCards();

            // ì •ë ¬ ì„ íƒ ë³€ê²½ ì´ë²¤íŠ¸
            const sortSelect = document.getElementById('sortSelect');
            if (sortSelect) {
                sortSelect.addEventListener('change', loadGoldPrices);
            }

            // ê¸°ê°„ ì„ íƒ ë³€ê²½ ì´ë²¤íŠ¸
            const periodSelect = document.getElementById('periodSelect');
            if (periodSelect) {
                periodSelect.addEventListener('change', loadGoldPrices);
            }

            // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì´ë²¤íŠ¸
            const refreshBtn = document.getElementById('refreshBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', loadGoldPrices);
            }
        });
    </script>
</body>
</html>
